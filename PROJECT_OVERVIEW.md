# AiKv é¡¹ç›®æ¦‚è§ˆ

## ğŸ“ é¡¹ç›®ç»“æ„

```
aikv/
â”œâ”€â”€ Cargo.toml              # Rusté¡¹ç›®é…ç½®æ–‡ä»¶
â”œâ”€â”€ README.md               # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ LICENSE                 # å¼€æºè®¸å¯è¯
â”œâ”€â”€ .gitignore             # Gitå¿½ç•¥æ–‡ä»¶é…ç½®
â”‚
â”œâ”€â”€ IMPLEMENTATION_PLAN.md  # è¯¦ç»†å®æ–½è®¡åˆ’ï¼ˆ14ä¸ªé˜¶æ®µï¼‰
â”œâ”€â”€ TODO.md                 # ä»»åŠ¡æ¸…å•ï¼ˆçº¦120ä¸ªä»»åŠ¡ï¼‰
â”œâ”€â”€ PROJECT_OVERVIEW.md     # æœ¬æ–‡ä»¶
â”‚
â”œâ”€â”€ src/                    # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ lib.rs             # åº“å…¥å£æ–‡ä»¶ï¼ˆDBä¸»æ¥å£ï¼‰
â”‚   â”œâ”€â”€ error.rs           # é”™è¯¯ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ config.rs          # é…ç½®é€‰é¡¹
â”‚
â”œâ”€â”€ tests/                  # é›†æˆæµ‹è¯•ç›®å½•ï¼ˆå¾…å®ç°ï¼‰
â”œâ”€â”€ benches/               # æ€§èƒ½åŸºå‡†æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ write_bench.rs     # å†™å…¥æ€§èƒ½æµ‹è¯•
â”‚   â””â”€â”€ read_bench.rs      # è¯»å–æ€§èƒ½æµ‹è¯•
â”‚
â”œâ”€â”€ examples/              # ç¤ºä¾‹ä»£ç 
â”‚   â””â”€â”€ basic.rs          # åŸºç¡€ä½¿ç”¨ç¤ºä¾‹
â”‚
â””â”€â”€ docs/                  # æ–‡æ¡£ç›®å½•ï¼ˆå¾…åˆ›å»ºï¼‰
```

## ğŸ¯ å½“å‰çŠ¶æ€

### âœ… å·²å®Œæˆ
1. **é¡¹ç›®åŸºç¡€è®¾æ–½**
   - âœ… Cargoå·¥ä½œç©ºé—´é…ç½®
   - âœ… é¡¹ç›®ç›®å½•ç»“æ„
   - âœ… åŸºç¡€ä¾èµ–åŒ…é…ç½®
   - âœ… .gitignoreé…ç½®
   - âœ… å®Œæ•´çš„READMEæ–‡æ¡£

2. **æ ¸å¿ƒç±»å‹å®šä¹‰**
   - âœ… Errorå’ŒResultç±»å‹ï¼ˆsrc/error.rsï¼‰
   - âœ… Optionsé…ç½®ç»“æ„ï¼ˆsrc/config.rsï¼‰
   - âœ… DBä¸»ç»“æ„æ¡†æ¶ï¼ˆsrc/lib.rsï¼‰

3. **æ–‡æ¡£ä¸è§„åˆ’**
   - âœ… è¯¦ç»†å®æ–½è®¡åˆ’ï¼ˆIMPLEMENTATION_PLAN.mdï¼‰
   - âœ… ä»»åŠ¡æ¸…å•ï¼ˆTODO.mdï¼‰
   - âœ… APIæ–‡æ¡£æ³¨é‡Š
   - âœ… ä½¿ç”¨ç¤ºä¾‹

4. **è´¨é‡ä¿è¯**
   - âœ… é¡¹ç›®å¯ä»¥æˆåŠŸç¼–è¯‘
   - âœ… 6ä¸ªå•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡
   - âœ… 5ä¸ªæ–‡æ¡£æµ‹è¯•ç¼–è¯‘é€šè¿‡
   - âœ… Clippyé™æ€æ£€æŸ¥æ— è­¦å‘Š

### ğŸš§ å¾…å®ç°ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰

#### é˜¶æ®µä¸€ï¼šWALå®ç°ï¼ˆP0ï¼‰
- [ ] æ—¥å¿—æ ¼å¼è®¾è®¡
- [ ] WALWriterå®ç°
- [ ] WALReaderå®ç°
- [ ] æ—¥å¿—æ¢å¤åŠŸèƒ½

#### é˜¶æ®µäºŒï¼šMemTableå®ç°ï¼ˆP0ï¼‰
- [ ] SkipListæ•°æ®ç»“æ„
- [ ] å¹¶å‘æ§åˆ¶
- [ ] åŸºæœ¬CRUDæ“ä½œ
- [ ] è¿­ä»£å™¨

#### é˜¶æ®µä¸‰ï¼šSSTableå®ç°ï¼ˆP1ï¼‰
- [ ] Blockæ ¼å¼è®¾è®¡
- [ ] SSTableBuilder
- [ ] SSTableReader
- [ ] ç´¢å¼•å—å’Œæ•°æ®å—

#### é˜¶æ®µå››ï¼šç‰ˆæœ¬ç®¡ç†ï¼ˆP1ï¼‰
- [ ] Versionç»“æ„
- [ ] VersionEdit
- [ ] Manifestæ—¥å¿—

#### é˜¶æ®µäº”ï¼šCompactionï¼ˆP1ï¼‰
- [ ] æ–‡ä»¶é€‰æ‹©ç­–ç•¥
- [ ] å¤šè·¯å½’å¹¶
- [ ] åå°æ‰§è¡Œ

#### åç»­é˜¶æ®µï¼ˆP2-P3ï¼‰
- [ ] è¿­ä»£å™¨å®ç°
- [ ] Bloom Filter
- [ ] ç¼“å­˜ç³»ç»Ÿ
- [ ] å¿«ç…§æ”¯æŒ
- [ ] æ€§èƒ½ä¼˜åŒ–

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¼–è¯‘é¡¹ç›®
```bash
# å¼€å‘æ¨¡å¼ç¼–è¯‘
cargo build

# å‘å¸ƒæ¨¡å¼ç¼–è¯‘ï¼ˆä¼˜åŒ–ï¼‰
cargo build --release
```

### è¿è¡Œæµ‹è¯•
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cargo test

# è¿è¡Œç‰¹å®šæµ‹è¯•
cargo test test_error_display

# æŸ¥çœ‹æµ‹è¯•è¾“å‡º
cargo test -- --nocapture
```

### ä»£ç æ£€æŸ¥
```bash
# è¿è¡ŒClippyé™æ€åˆ†æ
cargo clippy

# æ ¼å¼åŒ–ä»£ç 
cargo fmt

# ç”Ÿæˆæ–‡æ¡£
cargo doc --open
```

### è¿è¡Œç¤ºä¾‹
```bash
# å½“DBå®ç°å®Œæˆåï¼Œå¯ä»¥è¿è¡Œï¼š
cargo run --example basic
```

## ğŸ“Š æŠ€æœ¯æ ˆ

### æ ¸å¿ƒä¾èµ–
- **bytes (1.5)**: é«˜æ•ˆçš„å­—èŠ‚ç¼“å†²åŒº
- **parking_lot (0.12)**: é«˜æ€§èƒ½çš„é”å®ç°
- **crossbeam (0.8)**: å¹¶å‘åŸè¯­å’Œæ•°æ®ç»“æ„
- **crossbeam-skiplist (0.1)**: å¹¶å‘è·³è¡¨å®ç°
- **crc32fast (1.4)**: å¿«é€ŸCRC32æ ¡éªŒå’Œ

### åºåˆ—åŒ–
- **serde (1.0)**: åºåˆ—åŒ–æ¡†æ¶
- **bincode (1.3)**: äºŒè¿›åˆ¶åºåˆ—åŒ–

### å‹ç¼©
- **snap (1.1)**: Snappyå‹ç¼©ï¼ˆé»˜è®¤ç‰¹æ€§ï¼‰
- **lz4 (1.24)**: LZ4å‹ç¼©ï¼ˆå¯é€‰ç‰¹æ€§ï¼‰

### å¼€å‘å·¥å…·
- **criterion (0.5)**: æ€§èƒ½åŸºå‡†æµ‹è¯•
- **proptest (1.4)**: å±æ€§æµ‹è¯•
- **tempfile (3.8)**: ä¸´æ—¶æ–‡ä»¶å¤„ç†
- **env_logger (0.11)**: æ—¥å¿—è¾“å‡º

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### LSM-Treeåˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Application Layer            â”‚
â”‚         (DB API Interface)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Write Path (å†™å…¥è·¯å¾„)         â”‚
â”‚                                       â”‚
â”‚  1. Write to WAL (æŒä¹…åŒ–)             â”‚
â”‚  2. Write to MemTable (å†…å­˜)          â”‚
â”‚  3. Check if full â†’ Trigger Flush     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Read Path (è¯»å–è·¯å¾„)          â”‚
â”‚                                       â”‚
â”‚  1. Check MemTable (æœ€æ–°æ•°æ®)         â”‚
â”‚  2. Check Immutable MemTables         â”‚
â”‚  3. Check Block Cache (çƒ­æ•°æ®)        â”‚
â”‚  4. Search SSTables (Level 0â†’N)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Background Tasks (åå°ä»»åŠ¡)       â”‚
â”‚                                       â”‚
â”‚  â€¢ Flush: MemTable â†’ SSTable         â”‚
â”‚  â€¢ Minor Compaction (Level 0)        â”‚
â”‚  â€¢ Major Compaction (Level 1+)       â”‚
â”‚  â€¢ Garbage Collection                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµå‘

```
Write:  Client â†’ WAL â†’ MemTable â†’ SSTable(L0) â†’ ... â†’ SSTable(LN)
                                    â†‘
                                  Flush
Read:   Client â†’ MemTable? â†’ Imm MemTable? â†’ Cache? â†’ SSTable(L0â†’LN)
```

### æ–‡ä»¶ç»„ç»‡

```
data/
â”œâ”€â”€ MANIFEST-000001      # å…ƒæ•°æ®æ—¥å¿—
â”œâ”€â”€ CURRENT              # æŒ‡å‘å½“å‰Manifest
â”œâ”€â”€ 000001.log          # WALæ–‡ä»¶
â”œâ”€â”€ 000002.sst          # Level 0 SSTable
â”œâ”€â”€ 000003.sst          # Level 0 SSTable
â”œâ”€â”€ 000004.sst          # Level 1 SSTable
â””â”€â”€ ...
```

## ğŸ“‹ å®æ–½æŒ‡å—

### å¼€å‘æµç¨‹

1. **é€‰æ‹©ä»»åŠ¡**ï¼šä»TODO.mdä¸­é€‰æ‹©P0ä»»åŠ¡
2. **é˜…è¯»è®¡åˆ’**ï¼šå‚è€ƒIMPLEMENTATION_PLAN.mdäº†è§£è¯¦ç»†è¦æ±‚
3. **å®ç°åŠŸèƒ½**ï¼šç¼–å†™ä»£ç å¹¶æ·»åŠ æ–‡æ¡£æ³¨é‡Š
4. **ç¼–å†™æµ‹è¯•**ï¼šç¡®ä¿æœ‰å®Œæ•´çš„å•å…ƒæµ‹è¯•
5. **è¿è¡Œæµ‹è¯•**ï¼š`cargo test`
6. **ä»£ç æ£€æŸ¥**ï¼š`cargo clippy && cargo fmt`
7. **æ›´æ–°æ¸…å•**ï¼šæ ‡è®°ä»»åŠ¡ä¸ºå®Œæˆ

### ç¼–ç è§„èŒƒ

1. **å‘½åçº¦å®š**
   - ç±»å‹åï¼šå¤§é©¼å³°ï¼ˆPascalCaseï¼‰
   - å‡½æ•°/å˜é‡ï¼šå°å†™ä¸‹åˆ’çº¿ï¼ˆsnake_caseï¼‰
   - å¸¸é‡ï¼šå¤§å†™ä¸‹åˆ’çº¿ï¼ˆSCREAMING_SNAKE_CASEï¼‰

2. **æ–‡æ¡£è¦æ±‚**
   - æ‰€æœ‰å…¬å…±APIå¿…é¡»æœ‰æ–‡æ¡£æ³¨é‡Š
   - ä½¿ç”¨`///`è¿›è¡Œæ–‡æ¡£æ³¨é‡Š
   - åŒ…å«ç¤ºä¾‹ä»£ç ï¼ˆå½“åŠŸèƒ½å®ç°åï¼‰

3. **é”™è¯¯å¤„ç†**
   - ä½¿ç”¨`Result<T>`è¿”å›ç±»å‹
   - ä¸è¦ä½¿ç”¨`unwrap()`å’Œ`expect()`åœ¨åº“ä»£ç ä¸­
   - ä½¿ç”¨`?`æ“ä½œç¬¦ä¼ æ’­é”™è¯¯

4. **æµ‹è¯•è¦æ±‚**
   - æ¯ä¸ªæ¨¡å—éƒ½æœ‰`#[cfg(test)] mod tests`
   - å•å…ƒæµ‹è¯•è¦†ç›–æ­£å¸¸å’Œå¼‚å¸¸æƒ…å†µ
   - é›†æˆæµ‹è¯•è¦†ç›–å®Œæ•´æµç¨‹

### æ€§èƒ½ç›®æ ‡

åŸºäºRocksDBæ€§èƒ½çš„50-70%ä¸ºç›®æ ‡ï¼š

| æ“ä½œç±»å‹ | ç›®æ ‡æ€§èƒ½ | å‚è€ƒ |
|---------|---------|------|
| é¡ºåºå†™å…¥ | > 100K ops/s | RocksDB: ~200K |
| éšæœºå†™å…¥ | > 50K ops/s  | RocksDB: ~100K |
| é¡ºåºè¯»å– | > 150K ops/s | RocksDB: ~300K |
| éšæœºè¯»å– | > 100K ops/s | RocksDB: ~200K |

## ğŸ” è°ƒè¯•æŠ€å·§

### å¯ç”¨æ—¥å¿—
```bash
# è®¾ç½®æ—¥å¿—çº§åˆ«
RUST_LOG=debug cargo run --example basic

# åªæ˜¾ç¤ºaikvçš„æ—¥å¿—
RUST_LOG=aikv=debug cargo run --example basic
```

### æ€§èƒ½åˆ†æ
```bash
# è¿è¡ŒåŸºå‡†æµ‹è¯•
cargo bench

# ç”Ÿæˆç«ç„°å›¾ï¼ˆéœ€è¦å®‰è£…cargo-flamegraphï¼‰
cargo flamegraph --example basic
```

### å†…å­˜æ£€æŸ¥
```bash
# ä½¿ç”¨Valgrindæ£€æµ‹å†…å­˜æ³„æ¼
valgrind --leak-check=full ./target/debug/examples/basic
```

## ğŸ“š å­¦ä¹ èµ„æº

### å¿…è¯»è®ºæ–‡
1. **LSM-Tree**: "The Log-Structured Merge-Tree (LSM-Tree)" - O'Neil et al.
2. **Bigtable**: "Bigtable: A Distributed Storage System for Structured Data" - Google

### æ¨èé¡¹ç›®
1. **RocksDB**: https://github.com/facebook/rocksdb
2. **LevelDB**: https://github.com/google/leveldb
3. **mini-lsm**: https://github.com/skyzh/mini-lsm (Rustæ•™å­¦é¡¹ç›®)
4. **sled**: https://github.com/spacejam/sled (RuståµŒå…¥å¼æ•°æ®åº“)

### Rustå­¦ä¹ 
1. Rust Book: https://doc.rust-lang.org/book/
2. Rust by Example: https://doc.rust-lang.org/rust-by-example/
3. Async Rust: https://rust-lang.github.io/async-book/

## ğŸ¤ è´¡çŒ®æŒ‡å—

### æäº¤ä»£ç 
1. Forké¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ï¼š`git checkout -b feature/your-feature`
3. æäº¤æ›´æ”¹ï¼š`git commit -am 'Add some feature'`
4. æ¨é€åˆ†æ”¯ï¼š`git push origin feature/your-feature`
5. æäº¤Pull Request

### ä»£ç å®¡æŸ¥æ ‡å‡†
- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡
- âœ… Clippyæ— è­¦å‘Š
- âœ… ä»£ç æ ¼å¼åŒ–ï¼ˆcargo fmtï¼‰
- âœ… æ–‡æ¡£å®Œæ•´
- âœ… æ€§èƒ½æ— æ˜æ˜¾é€€åŒ–

## ğŸ“ˆ é‡Œç¨‹ç¢‘è®¡åˆ’

### Milestone 1: åŸºç¡€åŠŸèƒ½ (çº¦4å‘¨)
- [x] é¡¹ç›®åˆå§‹åŒ–
- [ ] WALå®ç°
- [ ] MemTableå®ç°
- [ ] åŸºç¡€è¯»å†™åŠŸèƒ½

### Milestone 2: æŒä¹…åŒ– (çº¦4å‘¨)
- [ ] SSTableå®ç°
- [ ] Versionç®¡ç†
- [ ] å´©æºƒæ¢å¤

### Milestone 3: ä¼˜åŒ– (çº¦4å‘¨)
- [ ] Compaction
- [ ] Bloom Filter
- [ ] Block Cache

### Milestone 4: é«˜çº§ç‰¹æ€§ (çº¦2å‘¨)
- [ ] å¿«ç…§
- [ ] è¿­ä»£å™¨
- [ ] å‹ç¼©

### Milestone 5: ç”Ÿäº§å°±ç»ª (çº¦2å‘¨)
- [ ] å®Œæ•´æµ‹è¯•è¦†ç›–
- [ ] æ€§èƒ½åŸºå‡†
- [ ] æ–‡æ¡£å®Œå–„

## ğŸ“ è”ç³»æ–¹å¼

- Issues: é€šè¿‡GitHub IssuesæŠ¥å‘Šé—®é¢˜
- Discussions: ä½¿ç”¨GitHub Discussionsè¿›è¡Œè®¨è®º
- Email: [å¾…æ·»åŠ ]

---

**æœ€åæ›´æ–°**: 2025-11-04
**ç‰ˆæœ¬**: 0.1.0-dev
**çŠ¶æ€**: ğŸš§ å¼€å‘ä¸­
